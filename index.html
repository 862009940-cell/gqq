<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®è´ï¼Œä¸‹ç­å¿«ä¹ï¼</title>
    <style>
        /* --- åŸºç¡€å¸ƒå±€ --- */
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Microsoft YaHei', sans-serif;
            user-select: none;
        }

        /* --- 3D ç”»å¸ƒ --- */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* --- æŒ‰é’®å±‚ --- */
        #btn-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
        }

        #start-btn {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 20px 60px;
            font-size: 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.5s;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
            letter-spacing: 2px;
        }

        #start-btn:hover {
            background: rgba(255, 105, 180, 0.3);
            transform: scale(1.1);
            box-shadow: 0 0 40px rgba(255, 105, 180, 0.8);
        }

        /* --- å¡ç‰‡æ ·å¼ --- */
        #message-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            z-index: 999; /* æœ€é«˜å±‚çº§ */

            background: rgba(20, 20, 20, 0.85); /* ç¨å¾®æ·±ä¸€ç‚¹ï¼Œå¢åŠ å¯¹æ¯”åº¦ */
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid rgba(255, 105, 180, 0.4);
            box-shadow: 0 0 80px rgba(0,0,0,0.8);
            color: white;
            min-width: 320px;
            max-width: 90%;

            /* åŠ¨ç”»è¿‡æ¸¡ */
            opacity: 0;
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .show-card {
            opacity: 1 !important;
            transform: translate(-50%, -50%) scale(1) !important;
            pointer-events: auto !important;
        }

        /* å…³é—­æŒ‰é’® (å³ä¸Šè§’ X) */
        .close-icon {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s;
        }
        .close-icon:hover { color: #fff; }

        /* åº•éƒ¨æ”¶èµ·æŒ‰é’® */
        .hide-btn {
            margin-top: 25px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ddd;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        .hide-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #fff;
            color: #fff;
        }

        /* å¬å›æŒ‰é’® (å·¦ä¸‹è§’å°ä¿¡å°) */
        #recall-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 990;
            font-size: 2rem;
            cursor: pointer;
            opacity: 0; /* åˆå§‹éšè— */
            pointer-events: none;
            transition: all 0.5s;
            filter: drop-shadow(0 0 10px rgba(255,105,180,0.5));
            animation: floatBtn 3s ease-in-out infinite;
        }
        /* å¬å›æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€ */
        .show-recall {
            opacity: 1 !important;
            pointer-events: auto !important;
        }
        @keyframes floatBtn {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 { margin: 0 0 15px 0; font-size: 2rem; color: #ff69b4; text-shadow: 0 0 10px #ff69b4; }
        p { font-size: 1.2rem; line-height: 1.8; color: #eee; margin-bottom: 10px;}
        .small-text { font-size: 0.95rem; color: #bbb; margin-top: 20px; font-style: italic;}

        /* --- æ°”çƒ --- */
        .balloon {
            position: fixed;
            bottom: -100px;
            font-size: 3rem;
            animation: floatUp 5s ease-in forwards;
            z-index: 100;
            opacity: 0.9;
        }
        @keyframes floatUp {
            to { transform: translateY(-120vh) rotate(20deg); opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <!-- æŒ‰é’®å±‚ -->
    <div id="btn-container">
        <button id="start-btn" onclick="startCeremony()">ç‚¹å‡»æ­£å¼ä¸‹ç­</button>
    </div>

    <!-- å¡ç‰‡å±‚ -->
    <div id="message-card">
        <!-- å³ä¸Šè§’å…³é—­ -->
        <div class="close-icon" onclick="toggleCard(false)">Ã—</div>

        <h1>ğŸ‰ å®è´è¾›è‹¦å•¦ï¼</h1>
        <p>
            æ­å–œè§£é”èŒåœºæ–°åœ°å›¾ï¼<br>
            ç¬¬ä¸€å¤©è¡¨ç°ä¸€å®šå¾ˆæ£’å§ã€‚<br>
            æ— è®ºå¤šå¿™ï¼Œæˆ‘éƒ½åœ¨ä½ èº«åã€‚
        </p>
        <p class="small-text">
            æƒ³åƒä»€ä¹ˆï¼Œè€å…¬æ¥ä¹°å•ï¼â¤ï¸
        </p>

        <!-- åº•éƒ¨æ”¶èµ·æŒ‰é’® -->
        <button class="hide-btn" onclick="toggleCard(false)">æ”¶èµ·å¡ç‰‡ï¼Œæ¬£èµçˆ±å¿ƒ</button>
    </div>

    <!-- å¬å›æŒ‰é’® (å°ä¿¡å°) -->
    <div id="recall-btn" onclick="toggleCard(true)">ğŸ’Œ</div>

    <script src="https://cdn.staticfile.org/three.js/r128/three.min.js"></script>
    <script src="https://cdn.staticfile.org/canvas-confetti/1.6.0/confetti.browser.min.js"></script>

    <script>
        // --- 3D åœºæ™¯åˆå§‹åŒ– ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.001);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
        camera.position.z = 100;
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // --- 1. æ˜Ÿç©º ---
        const starGeo = new THREE.BufferGeometry();
        const starCount = 4000;
        const starPos = [];
        for(let i=0; i<starCount; i++) {
            starPos.push((Math.random()-0.5)*2000, (Math.random()-0.5)*2000, (Math.random()-0.5)*2000);
        }
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 1.5, transparent: true, opacity: 0.8 });
        const starField = new THREE.Points(starGeo, starMat);
        scene.add(starField);

        // --- 2. çˆ±å¿ƒ ---
        const heartGeo = new THREE.BufferGeometry();
        const heartCount = 3000;
        const heartPos = [];
        const heartTargetPos = [];

        function getHeartPoint(t) {
            const x = 16 * Math.pow(Math.sin(t), 3);
            const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            return { x: x * 3.5, y: y * 3.5 };
        }

        for(let i=0; i<heartCount; i++) {
            heartPos.push((Math.random()-0.5)*1000, (Math.random()-0.5)*1000, 500);
            let t = Math.PI * 2 * Math.random();
            let p = getHeartPoint(t);
            heartTargetPos.push(p.x, p.y, (Math.random()-0.5)*20);
        }

        heartGeo.setAttribute('position', new THREE.Float32BufferAttribute(heartPos, 3));
        const heartMat = new THREE.PointsMaterial({
            color: 0xff69b4,
            size: 2.0,
            transparent: true,
            opacity: 0,
            blending: THREE.AdditiveBlending
        });
        const heartParticles = new THREE.Points(heartGeo, heartMat);
        scene.add(heartParticles);

        // --- åŠ¨ç”»å¾ªç¯ ---
        let isStarted = false;
        let time = 0;

        function animate() {
            requestAnimationFrame(animate);
            time += 0.05;

            // æ˜Ÿç©ºç§»åŠ¨
            const positions = starField.geometry.attributes.position.array;
            for(let i=2; i<starCount*3; i+=3) {
                positions[i] += 5;
                if(positions[i] > 200) positions[i] = -1800;
            }
            starField.geometry.attributes.position.needsUpdate = true;
            starField.rotation.z += 0.001;

            // çˆ±å¿ƒé€»è¾‘
            if (isStarted) {
                if (heartMat.opacity < 1) heartMat.opacity += 0.01;
                const hPos = heartParticles.geometry.attributes.position.array;
                const beat = 1 + Math.sin(time * 2.5) * 0.05;

                for(let i=0; i<heartCount; i++) {
                    const ix = i * 3;
                    const iy = i * 3 + 1;
                    const iz = i * 3 + 2;
                    let tx = heartTargetPos[ix] * beat;
                    let ty = heartTargetPos[iy] * beat;
                    let tz = heartTargetPos[iz] * beat;

                    hPos[ix] += (tx - hPos[ix]) * 0.05;
                    hPos[iy] += (ty - hPos[iy]) * 0.05;
                    hPos[iz] += (tz - hPos[iz]) * 0.05;
                }
                heartParticles.geometry.attributes.position.needsUpdate = true;
                heartParticles.rotation.y = Math.sin(time * 0.5) * 0.1;
            }
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- äº¤äº’é€»è¾‘ ---
        function startCeremony() {
            isStarted = true;

            // 1. ç§»é™¤å¼€å§‹æŒ‰é’®
            const btn = document.getElementById('start-btn');
            btn.style.opacity = '0';
            btn.style.transform = 'scale(0)';
            setTimeout(() => btn.remove(), 1000);

            // 2. å½©å¸¦
            try {
                if(typeof confetti === 'function') {
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#ff69b4', '#fff'] });
                    let end = Date.now() + 2000;
                    (function frame() {
                        confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ff69b4', '#fff'] });
                        confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ff69b4', '#fff'] });
                        if (Date.now() < end) requestAnimationFrame(frame);
                    }());
                }
            } catch(e){}

            // 3. æ°”çƒ
            const emojis = ['ğŸˆ', 'ğŸ’–', 'ğŸ‰', 'ğŸŒ¸', 'âœ¨'];
            for (let i = 0; i < 25; i++) {
                const b = document.createElement('div');
                b.className = 'balloon';
                b.innerText = emojis[Math.floor(Math.random()*emojis.length)];
                b.style.left = (Math.random()*90 + 5) + 'vw';
                b.style.animationDuration = (Math.random()*3 + 3) + 's';
                document.body.appendChild(b);
            }

            // 4. æ˜¾ç¤ºå¡ç‰‡
            setTimeout(() => {
                toggleCard(true);
            }, 1500);
        }

        // --- åˆ‡æ¢å¡ç‰‡æ˜¾ç¤º/éšè— ---
        function toggleCard(show) {
            const card = document.getElementById('message-card');
            const recallBtn = document.getElementById('recall-btn');

            if (show) {
                // æ˜¾ç¤ºå¡ç‰‡ï¼Œéšè—å°ä¿¡å°
                card.classList.add('show-card');
                recallBtn.classList.remove('show-recall');
            } else {
                // éšè—å¡ç‰‡ï¼Œæ˜¾ç¤ºå°ä¿¡å°
                card.classList.remove('show-card');
                recallBtn.classList.add('show-recall');
            }
        }
    </script>
</body>
</html>
